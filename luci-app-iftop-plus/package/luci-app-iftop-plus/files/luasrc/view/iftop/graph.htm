<%+header%>
<h2>流量趋势图</h2>
<select id="interval">
  <option value="3600">每小时</option>
  <option value="86400">每天</option>
  <option value="600">每10分钟</option>
</select>
<canvas id="chart" height="120"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function loadData() {
  const interval = document.getElementById("interval").value;
  const res = await fetch('/cgi-bin/luci/admin/network/iftop/api/history?interval=' + interval);
  const json = await res.json();
  const labels = json.map(item => new Date(item.ts * 1000).toLocaleString());
  const data = json.map(item => item.total / 1024);
  new Chart(document.getElementById('chart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: "流量 (KB)",
        data: data,
        fill: false,
        borderColor: "blue",
        tension: 0.1
      }]
    }
  });
}
document.getElementById("interval").addEventListener("change", loadData);
loadData();
</script>
<%+footer%>
